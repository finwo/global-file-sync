case "$1" in
  --help|-h)
    echo "Usage: retry.sh <count> <command> [...arg]"
    exit 0
    ;;
esac

max_attempts="$1"
shift

cmd="$@"
attempt_num=1

until $cmd
do
  if test "$attempt_num" -ge "$max_attempts"; then
    echo "Attempt $attempt_num failed and there are no more attempts left!"
    exit 1
  fi

  sleep_time=$(( $attempt_num * 2 ))
  echo "Attempt $attempt_num failed! Trying again in $sleep_time seconds..."
  attempt_num=$(( $attempt_num + 1 ))
  sleep $sleep_time
done
